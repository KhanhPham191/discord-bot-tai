# Code Examples - Track Team Implementation\n\n## Helper Functions Usage\n\n### Adding a Team\n```javascript\n// Add Chelsea with Channel preference\naddUserTrackedTeam(userId, 61, 'channel');\n// Config: userTrackedTeams[userId][61] = { preference: 'channel' }\n\n// Add Man City with DM preference\naddUserTrackedTeam(userId, 65, 'dm');\n// Config: userTrackedTeams[userId][65] = { preference: 'dm' }\n\n// Default to channel if not specified\naddUserTrackedTeam(userId, 66);\n// Config: userTrackedTeams[userId][66] = { preference: 'channel' }\n```\n\n### Getting Preferences\n```javascript\n// Get all teams for a user (array format)\nconst teams = getUserTrackedTeams(userId);\n// Returns: [61, 65, 66]\n\n// Get all teams with preferences\nconst teamPrefs = getUserTrackedTeamsWithPreferences(userId);\n// Returns: { 61: {preference: 'channel'}, 65: {preference: 'dm'} }\n\n// Get one team's preference\nconst pref = getUserTeamPreference(userId, 61);\n// Returns: 'channel' or 'dm'\n```\n\n### Changing Preference\n```javascript\n// User wants to change Chelsea from channel to DM\nsetUserTeamPreference(userId, 61, 'dm');\n// Config updated: userTrackedTeams[userId][61].preference = 'dm'\n\n// Or just re-track with new preference\naddUserTrackedTeam(userId, 61, 'dm'); // Updates existing\n```\n\n### Removing a Team\n```javascript\n// Remove Chelsea\nremoveUserTrackedTeam(userId, 61);\n// Deletes: userTrackedTeams[userId][61]\n```\n\n## Notification System Usage\n\n### Sending Match Reminder (Based on Preference)\n```javascript\nconst userId = interaction.user.id;\nconst teamId = 61;\nconst preference = getUserTeamPreference(userId, teamId);\n\nconst embed = new EmbedBuilder()\n  .setTitle('âš ï¸ Match Reminder')\n  .setDescription('Chelsea vs Arsenal in 24 hours');\n\nif (preference === 'dm') {\n  // Send DM\n  const user = await client.users.fetch(userId);\n  await user.send({ embeds: [embed] });\n  console.log('ðŸ“¨ Sent DM');\n} else {\n  // Send to channel\n  const channel = await client.channels.fetch(channelId);\n  await channel.send({ embeds: [embed] });\n  console.log('ðŸ“¢ Sent to channel');\n}\n```\n\n### Batch Notification (All Users)\n```javascript\nfor (const [userId, teamData] of Object.entries(config.userTrackedTeams)) {\n  // Handle both old array and new object format\n  let teams = [];\n  if (Array.isArray(teamData)) {\n    teams = teamData;\n  } else {\n    teams = Object.keys(teamData).map(id => parseInt(id));\n  }\n  \n  for (const teamId of teams) {\n    const preference = getUserTeamPreference(userId, teamId);\n    \n    if (preference === 'dm') {\n      // Send DM\n      const user = await client.users.fetch(userId);\n      await user.send({ embeds: [embed] });\n    } else {\n      // Send to channel\n      for (const channelConfig of config.footballReminder.channels) {\n        const channel = await client.channels.fetch(channelConfig.id);\n        await channel.send({ embeds: [embed] });\n      }\n    }\n  }\n}\n```\n\n## Command Implementation\n\n### /track-team Command Handler\n```javascript\nif (command === 'track-team') {\n  const teamId = interaction.options.getInteger('team_id');\n  const notificationType = interaction.options.getString('notification') || 'channel';\n  \n  const team = config.livescoreTeams.find(t => t.id === teamId);\n  if (!team) {\n    await interaction.reply(`âŒ KhÃ´ng tÃ¬m tháº¥y team vá»›i ID **${teamId}**!`);\n    return;\n  }\n  \n  // Add team with preference\n  addUserTrackedTeam(userId, teamId, notificationType);\n  \n  const prefixEmoji = notificationType === 'dm' ? 'ðŸ’¬' : 'ðŸ“¢';\n  const prefixText = notificationType === 'dm' ? 'Tin nháº¯n riÃªng (DM)' : 'KÃªnh';\n  \n  await interaction.reply({\n    content: `âœ… **Äang theo dÃµi ${team.name}**\\n${prefixEmoji} Nháº­n thÃ´ng bÃ¡o qua: **${prefixText}**`,\n    flags: 64 // Ephemeral\n  });\n}\n```\n\n### Preference Buttons Handler\n```javascript\nif (interaction.customId.startsWith('track_pref_channel_')) {\n  const teamId = parseInt(interaction.customId.replace('track_pref_channel_', ''));\n  const userId = interaction.user.id;\n  const team = config.livescoreTeams.find(t => t.id === teamId);\n  \n  // Add with channel preference\n  addUserTrackedTeam(userId, teamId, 'channel');\n  \n  await interaction.reply({\n    content: `âœ… Äang theo dÃµi **${team.name}**\\nðŸ“¢ Nháº­n thÃ´ng bÃ¡o á»Ÿ **kÃªnh nÃ y**`,\n    flags: 64\n  });\n}\n\nif (interaction.customId.startsWith('track_pref_dm_')) {\n  const teamId = parseInt(interaction.customId.replace('track_pref_dm_', ''));\n  const userId = interaction.user.id;\n  const team = config.livescoreTeams.find(t => t.id === teamId);\n  \n  // Add with DM preference\n  addUserTrackedTeam(userId, teamId, 'dm');\n  \n  await interaction.reply({\n    content: `âœ… Äang theo dÃµi **${team.name}**\\nðŸ’¬ Nháº­n thÃ´ng bÃ¡o qua **tin nháº¯n riÃªng**`,\n    flags: 64\n  });\n}\n```\n\n### /mytracks Display\n```javascript\nif (command === 'mytracks') {\n  const userTrackedTeams = getUserTrackedTeams(userId);\n  \n  if (userTrackedTeams.length === 0) {\n    await interaction.reply('ðŸ“‹ Báº¡n chÆ°a theo dÃµi team nÃ o.');\n    return;\n  }\n\n  const trackedTeamDetails = userTrackedTeams\n    .map(id => {\n      const team = config.livescoreTeams.find(t => t.id === id);\n      const teamName = team ? team.name : `ID: ${id}`;\n      const preference = getUserTeamPreference(userId, id);\n      const prefixEmoji = preference === 'dm' ? 'ðŸ’¬' : 'ðŸ“¢';\n      return `${prefixEmoji} ${teamName}`;\n    })\n    .join('\\n');\n  \n  await interaction.reply(\n    `ðŸ“‹ **Danh sÃ¡ch team báº¡n theo dÃµi:**\\n${trackedTeamDetails}\\n\\nðŸ“¢ = KÃªnh | ðŸ’¬ = DM`\n  );\n}\n```\n\n## Slash Command Definition\n\n```javascript\nnew SlashCommandBuilder()\n  .setName('track-team')\n  .setDescription('Theo dÃµi team + chá»n nháº­n thÃ´ng bÃ¡o á»Ÿ kÃªnh hay DM')\n  .addIntegerOption(option =>\n    option.setName('team_id')\n      .setDescription('ID cá»§a team muá»‘n theo dÃµi')\n      .setRequired(true))\n  .addStringOption(option =>\n    option.setName('notification')\n      .setDescription('Nháº­n thÃ´ng bÃ¡o á»Ÿ kÃªnh hay DM')\n      .setRequired(false)\n      .addChoices(\n        { name: 'ðŸ“¢ KÃªnh (Channel)', value: 'channel' },\n        { name: 'ðŸ’¬ Tin nháº¯n riÃªng (DM)', value: 'dm' }\n      ))\n```\n\n## Auto-Migration Example\n\n### Before (Old Format)\n```javascript\nconst userData = config.userTrackedTeams['userId123']; // [61, 65]\n```\n\n### Auto-Migration in getUserTrackedTeamsWithPreferences\n```javascript\nfunction getUserTrackedTeamsWithPreferences(userId) {\n  if (!config.userTrackedTeams) config.userTrackedTeams = {};\n  if (!config.userTrackedTeams[userId]) return {};\n  \n  const userData = config.userTrackedTeams[userId];\n  \n  // Detect old format (array)\n  if (Array.isArray(userData)) {\n    console.log('ðŸ”„ Auto-migrating old format...');\n    \n    const newFormat = {};\n    userData.forEach(teamId => {\n      newFormat[teamId] = { preference: 'channel' }; // Default\n    });\n    \n    // Update in memory and save\n    config.userTrackedTeams[userId] = newFormat;\n    saveConfig(); // Persist to file\n    \n    return newFormat;\n  } else {\n    // Already new format\n    return userData;\n  }\n}\n```\n\n### After (Auto-Migrated)\n```javascript\n// After calling function once:\nconst userData = config.userTrackedTeams['userId123'];\n// Now: { 61: { preference: 'channel' }, 65: { preference: 'channel' } }\n```\n\n## Real-time Save Example\n\n```javascript\n// Every change automatically saves\naddUserTrackedTeam(userId, teamId, 'dm');\n// â†“\n// config.userTrackedTeams[userId][teamId] = { preference: 'dm' };\n// â†“\n// saveConfig();\n// â†“\n// fs.writeFileSync(CONFIG_FILE, JSON.stringify(config, null, 2));\n// â†“\n// âœ… Saved to config.json\n```\n\n## Backward Compatibility Example\n\n```javascript\n// Old code still works\nconst teams = getUserTrackedTeams(userId);\n// Returns: [61, 65, 66] (same as before)\n\n// New code with preferences\nconst withPrefs = getUserTrackedTeamsWithPreferences(userId);\n// Returns: { 61: {preference: 'channel'}, ... }\n\n// New helper\nconst pref = getUserTeamPreference(userId, 61);\n// Returns: 'channel' or 'dm'\n```\n"